- name: ðŸš€ SSH Deploy to Oracle VM
  run: |
    ssh -o StrictHostKeyChecking=no ubuntu@140.245.27.38 << 'EOF'
      # Ensure .ssh directory exists
      mkdir -p ~/.ssh

      # Add GitHub.com to known_hosts (avoids host key prompt)
      ssh-keyscan github.com >> ~/.ssh/known_hosts

      # Clean previous build
      rm -rf ~/BRV1/brv-app

      # Clone the repo
      git clone git@github.com:Aarav500/brv-app.git ~/BRV1/brv-app

      cd ~/BRV1/brv-app

      docker-compose down || true
      docker system prune -af || true

      # Kill any container using the image to allow forced delete
      docker ps -aq --filter ancestor=brv-app_brv-streamlit | xargs -r docker rm -f

      docker rmi $(docker images -q) -f || true

      docker-compose build --no-cache
      docker-compose up -d
    EOF
